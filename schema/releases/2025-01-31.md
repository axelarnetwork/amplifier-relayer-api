# Changes released on 2025-01-31

|                | **Owner**                           |
|----------------|-------------------------------------|
| **Created By** | @ilyalukyanov <ilya@interoplabs.io> |

| **Network**          | **Tag/Commit**                                                                                         | **Deployment Status** | **Date**   |
|:---------------------|--------------------------------------------------------------------------------------------------------|-----------------------|------------|
| `devnet-amplifier`   | [676b610](https://github.com/axelarnetwork/axelar-eds/commit/676b61051f63d00692c7f12e1959559a3e87c612) | Deployed              | 2025-01-31 |
| `stagenet`           | -                                                                                                      | -                     | TBD        |
| `testnet`            | -                                                                                                      | -                     | TBD        |
| `mainnet`            | -                                                                                                      | -                     | TBD        |

## Background

Changes in this release focus on enabling custom chain integrations, especially non-smart-contract chains. In particular - XRPL.

## Breaking and mandatory changes

All changes in this set are non-breaking. All integrations should continue to function without interruptions.

## Overview

### New endpoints

```
POST /contracts/{wasmContractAddress}/queries
```

This endpoint is a helper for querying WASM contracts `POST /contracts/{wasmContractAddress}/broadcasts`. It doesn't add any custom logic and merely proxies requests to an Axelar LCD endpoint.

It passes its JSON payload as is via `/cosmwasm.wasm.v1.Query/SmartContractState` and returns raw JSON payload of the response back.

```
POST /payloads
GET  /payloads/{hash}
```

This pair of endpoints serve as an optional cache for large payloads to overcome size constraints that exists on some chains. E.g. on XRPL payloads cannot exceed 1KB. 

When a larger payload needs to be sent: 
1. an external app should store it via `POST /payloads`
2. only payload hash is included in the transaction on the source chain, not the whole payload
3. off-chain integration components should recognise such calls and resolve the full payload via `GET  /payloads/{hash}` (the payload is expected to be stored prior to when its hash becomes discoverable on chain)
4. full payload is sent via the `CALL` event.

Current limits:
- Access to both endpoints requires a valid mTLS certificate (if you have a working certificate already, it's sufficient for the new endpoints).
- Size of the stored payload is limited to 16KB.
- Combined rate limit for both endpoints is 1000 requests per 5 minutes per IP.

Limits can be increased if they are insufficient for your use case.

### New Events

- `CANNOT_ROUTE_MESSAGE`. If relayer uses custom routing logic, and it refuses or is unable to call `route_messages` (or its comparable operation), it could publish this event so that that status is reflected on Axelarscan. Otherwise, the message would appear stuck. If this event isn't applicable to your implementation, it can be ignored. Otherwise, it's highly recommended in the interest of UX.
- `APP/INTERCHAIN_TRANSFER_SENT` and `APP/INTERCHAIN_TRANSFER_RECEIVED`. These events also serve the sole purpose of indexing on Axelarscan. They represent transfer of value via a dApp's custom implementation. At this stage they are only relevant for EVM chains and Squid. Unless it's been explicitly agreed, you don't need to implement ingestion for these events. 
  - Previously these events were incorrectly named `ITS_APP/INTERCHAIN_TRANSFER_SENT` and `ITS_APP/INTERCHAIN_TRANSFER_RECEIVED`. This set of changes corrects the naming. Technically this is a breaking change, but so far they are only supposed to be used internally in InteropLabs. Therefore, we aren't highlighting it as such.

### Updated Events

- `CALL` event received a new property `.meta.sourceContext` for associating arbitrary context with a message and receiving it back in `VERIFY` and `REFUND` tasks. Relayer at its own discretion may include arbitrary values when sending a `CALL` event. If such values were stored, `TaskItem` objects for `VERIFY` and `REFUND` task would contain them as they were sent in `.meta.sourceContext`.
  - The field isn't interpreted by our backend in any way.
  - At most 10 key-value pairs can be included. Each value cannot exceed 1000 characters. If these limits are insufficient they can be increased.

### New Tasks

- `REACT_TO_WASM_EVENT`. Our backend tracks certain well-known events (e.g. `wasm-quorum_reached`, `wasm-proof_under_construction`, etc. - as defined in reference contracts) on recognised WASM contracts (Voting Verifier, Multisig Prover, or Gateway). If such an event is detected, but cannot be parsed according to its definition in the corresponding reference contract, previously it would be silently ignored. Now, if parsing fails, our backend would publish a `REACT_TO_WASM_EVENT` task for the chain that owns its emitting contract. The task would contain raw event payload as emitted on Axelar. The relayer is expected to process or ignore this task at its own discretion in accordance with its logic.
  -  So far, this mechanism is only supported for `wasm-quorum_reached` events. In the future it can be extended to more event types.
  - An example of where this can be useful is when an integration needs to perform verification for objects that don't represent a `Message`. Our backend wouldn't know what to do with them. Thus, this is a way to delegate handling to the chain's relayer.

### Updated Tasks

- `VERIFY` and `REFUND` tasks (as described above) now have `.meta.sourceContext` at the level of their corresponding `TaskItem` envelopes.
- `GATEWAY_TX` task now has a new property `.meta.scopedMessages` that contains a list of `{ sourceChain, messageID }` if the payload carried by the task is associated with one or multiple messages. The field is omitted if the payload isn't associated with any messages.

### Miscellaneous

There was some renaming that may affect you if you codegen-ed from the schema. Shapes of API objects didn't change, only their names inside the schema:
- `BroadcastTxEvemt` -> `WasmEvent`
- `GatewayV2Message` -> `Message`
- `BroadcastTxEventAttribute` -> `WasmEventAttribute`